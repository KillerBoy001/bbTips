<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!-- $id $ -->
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. 
Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems 
within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
  <header>
    <license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
    <title lang="en-gb">bbDKP Tooltips Plugin 0.3.4</title>
    <description lang="en-gb">
	This bbDKP plugin provides Tooltips for Warcraft. 
</description>

    <author-notes lang="en-gb">
    works with bbdkp 1.1.0 or higher
    1) Press Install to let Automod copy the files and do the core edits. 
    2) Then browse to install/installbbtips.php and run the bbTips plugin table installer. Afterwards, delete the install folder.
    </author-notes>
    <author-group>
      <author>
        <username>Sajaki</username>
        <contributions-group>
      	<contributions status="past" from="2008-04-04"   position="Developer"/>
      	</contributions-group>	
      </author>   
    </author-group>
	<mod-version>0.3.4</mod-version>
    <installation>
      <level>easy</level>
      <time>300</time>
	<target-version>3.0.7-PL1</target-version>
    </installation>
    
<link-group>
	<link type="dependency" lang="en-gb" href="http://www.bbdkp.com/viewtopic.php?f=2&amp;t=1320">bbDkp 1.1.0</link>
	<link type="template" lang="en-gb" href="contrib/subsilver2.xml">Manual for subsilver2 Style</link>
</link-group>	

</header>

<action-group>
    <copy>
     <file from="root/adm/style/dkp/*.*" to="adm/style/dkp/*.*" />
     <file from="root/includes/bbdkp/bbtips/*.*" to="includes/bbdkp/bbtips/*.*" />
     <file from="root/includes/acp/*.*" to="includes/acp/*.*" />
     <file from="root/includes/acp/info/*.*" to="includes/acp/info/*.*" />
	 <file from="root/install/*.*" to="install/*.*" />  	 
     <file from="root/language/en/mods/*.*" to="language/en/mods/*.*" />
     <file from="root/styles/prosilver/theme/*.*" to="styles/prosilver/theme/*.*" />    
     <file from="root/umil/*.*" to="umil/*.*" />
    </copy>
<open src="config.php">
      <edit>
       <comment lang="en">is bbTips installed? </comment>
       
        <find><![CDATA[?>]]></find>
        <action type="before-add"><![CDATA[
@define('EMED_BBDKP_BBTIPS', true);
        ]]></action>
      </edit>
</open>
<open src="adm/style/admin.css">
    <edit>
	    <comment lang="en">patching table css to fix conflict with wowhead css</comment>
        <find><![CDATA[table {
	width: 100%;
	border: 1px solid #CCCFD3;
	background-color: #FFFFFF;]]></find>
        <action type="replace-with"><![CDATA[table {
	width: 100%;
	border: 1px solid #CCCFD3;
	/*background-color: #FFFFFF;*/]]></action>
    </edit>
</open>

<open src="includes/functions.php">
    <edit>
    	
	    <comment lang="en">Adding script selector for overall_header.html, either local wowhead js or remote</comment>
        <find><![CDATA['S_USER_NEW'					=> $user->data['user_new'],]]></find>
        <action type="after-add"><![CDATA[
		'S_BBTIPS_WHREMOTE'				=> (isset($config['bbtips_localjs']) ? $config['bbtips_localjs'] : ' '),]]></action>
    </edit>
</open>

<open src="includes/functions_content.php">
      <edit>
      <comment lang="en">Adding wowhead parser</comment>
        <find><![CDATA[$text = str_replace(array("\n", "\r"), array('<br />', "\n"), $text);]]></find>
        <action type="after-add"><![CDATA[// bbDdp
        global $phpbb_root_path, $phpEx;
		if(@defined("EMED_BBDKP")) 
		{
			if (!class_exists('bbtips')) 
			{
				require($phpbb_root_path . 'includes/bbdkp/bbtips/parse.' . $phpEx); 
			}
			$bbtips = new bbtips;
			$text = $bbtips->parse($text); 
		} 
]]></action>
      </edit>
</open>

<open src="includes/bbdkp/constants_bbdkp.php">
      <edit>
       <comment lang="en">adding required constants to bbdkp constants</comment>
       
        <find><![CDATA[// BBTIPS]]></find>
        <action type="after-add"><![CDATA[
define('BBTIPS_CACHE_TBL', $bbdkp_table_prefixx . 'wowhead_cache');							// main cache table
define('BBTIPS_CRAFT_TBL', $bbdkp_table_prefixx . 'wowhead_craftable');						// craftable table
define('BBTIPS_CRAFT_REAGENT_TBL', $bbdkp_table_prefixx . 'wowhead_craftable_reagent');		// table for reagents of craftable
define('BBTIPS_CRAFT_SPELL_TBL', $bbdkp_table_prefixx . 'wowhead_craftable_spell');			// craftable spells
define('BBTIPS_ITEMSET_TBL', $bbdkp_table_prefixx . 'wowhead_itemset');						// itemset table
define('BBTIPS_ITEMSET_REAGENT_TBL', $bbdkp_table_prefixx . 'wowhead_itemset_reagent');		// itemset reagent table
define('BBTIPS_GEM_TBL', $bbdkp_table_prefixx . 'wowhead_gems');							// gem table
define('BBTIPS_ENCHANT_TBL', $bbdkp_table_prefixx . 'wowhead_enchants');					// enchant table
define('BBTIPS_NPC_TBL', $bbdkp_table_prefixx . 'wowhead_npc');								// npc table
]]></action>
      </edit>
</open>

<open src="/adm/style/overall_header.html"> 
<edit>
		<comment lang="en">wowhead links in the ACP</comment>
		<find><![CDATA[</head>]]></find>
		<action type="before-add"><![CDATA[
<!-- Wowhead Item Links -->
<link href="style/wowhead.css" rel="stylesheet" type="text/css" />
<!-- IF S_BBTIPS_WHREMOTE -->
<script src="http://www.wowhead.com/widgets/power.js" type="text/javascript"></script>
<!-- ELSE -->
<script src="../includes/bbdkp/bbtips/js/power.js" type="text/javascript"></script>
<!-- ENDIF -->
]]></action>
</edit>
</open>

<open src="styles/prosilver/template/dkp/dkpheader.html"> 
<edit>
		<comment lang="en">wowhead links prosilver</comment>
		<find><![CDATA[<!-- BBTIPS -->]]></find>
		<action type="after-add"><![CDATA[
<!-- Wowhead Item Links -->
<link href="{T_THEME_PATH}/wowhead.css" rel="stylesheet" type="text/css" />
<!-- IF S_BBTIPS_WHREMOTE -->
<script src="http://www.wowhead.com/widgets/power.js" type="text/javascript"></script>
<!-- ELSE -->
<script src="./includes/bbdkp/bbtips/js/power.js" type="text/javascript"></script>
<!-- ENDIF -->
]]></action>
</edit>
</open>

<open src="/styles/prosilver/theme/stylesheet.css">
      <edit>
      <comment lang="en">bbdkp css prosilver</comment>
        <find><![CDATA[@import url("bbdkp.css");]]></find>
		<action type="after-add"><![CDATA[@import url("wowhead.css");
]]></action>
      </edit>
</open>

<diy-instructions lang="en">
1) Press Install to let Automod copy the files and do the core edits. 
2) Then browse to install/installbbtips.php and run the bbTips plugin table installer. Afterwards, delete the install folder.
    </diy-instructions>
  </action-group>
</mod>